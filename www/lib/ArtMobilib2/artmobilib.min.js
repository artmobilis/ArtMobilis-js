var compatibility=function(){var e=0,t=!0,n=window.URL||window.webkitURL||window.mozURL||window.msURL,i=function(t,n){var i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,n){var i=(new Date).getTime(),o=Math.max(0,16-(i-e)),a=window.setTimeout(function(){t(i+o)},o);return e=i+o,a};return i.call(window,t,n)},o=function(e){var t=window.cancelAnimationFrame||function(e){clearTimeout(e)};return t.call(window,e)},a=function(e,t,n){var i=window.navigator.getUserMedia||window.navigator.mozGetUserMedia||window.navigator.webkitGetUserMedia||window.navigator.msGetUserMedia||function(e,t,n){n()};return i.call(window.navigator,e,t,n)},r=function(){var e=new ArrayBuffer(8),n=new Uint32Array(e);return n[0]=4278190080,t=!0,255===e[0]&&(t=!1),t};return{URL:n,requestAnimationFrame:i,cancelAnimationFrame:o,getUserMedia:a,detectEndian:r,isLittleEndian:t}}();navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.URL=window.URL||window.webkitURL;var AM=AM||{};AM.FrontCamGrabbing=function(){function e(){c.readyState===c.HAVE_ENOUGH_DATA?(d=!1,a&&a()):window.requestAnimationFrame(e)}function t(t){return function(n){for(var i={video:!0,audio:!1},a=0;a!=n.length;++a){var r=n[a];"video"==r.kind&&"environment"==r.facing&&(i.video={optional:[{sourceId:r.id}]})}navigator.getUserMedia(i,function(t){o=t,c.src=window.URL.createObjectURL(t),e()},function(e){console.error("Cant getUserMedia()! due to ",e),t&&t()})}}function n(e){"undefined"!=typeof MediaStreamTrack&&"undefined"!=typeof MediaStreamTrack.getSources?MediaStreamTrack.getSources(t(e)):e&&e()}function i(e){"undefined"!=typeof navigator.mediaDevices&&"undefined"!=typeof navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(t(e)):e&&e()}var o,a,r,s=this,c=document.createElement("video"),d=!1;c.setAttribute("autoplay",!0),c.style.zIndex=-1,c.style.position="absolute",c.style.top="0px",c.style.left="0px",c.style.width="100%",c.style.height="100%",this.domElement=c,this.Start=function(e,t){s.IsActive()||d?e():(d=!0,a=e,r=t,n(function(){i(function(){r&&r(),a&&a()})}))},this.Stop=function(){o&&(o.getTracks()[0].stop(),o=void 0)},this.IsActive=function(){return void 0!==o}};var AM=AM||{};AM.ImageLoader=function(){var e=document.createElement("canvas"),t=e.getContext("2d");this.GetImageData=function(n,i,o){var a=new Image;a.onload=function(n,i,o){return function(){if(o){var a=Math.max(n.width,n.height),r=(a-n.width)/2,s=(a-n.height)/2;e.width=a,e.height=a,t.drawImage(n,r,s)}else e.width=n.width,e.height=n.height,t.drawImage(n,0,0,e.width,e.height);var c=t.getImageData(0,0,e.width,e.height);i(c)}}(a,i,o),a.src=n}};var AM=AM||{};AM.JsonLoader=function(){function e(e){u=!1,r=void 0,a=void 0,o=void 0,c=void 0,s=void 0,d.progress=0,e&&e()}function t(){try{d.json=JSON.parse(c.responseText),e(o)}catch(t){d.json={},e(a)}}function n(t){console.log("JsonLoader failed to open file: "+url),e(a)}function i(e){d.progress=e.loaded/e.total*100,r&&r()}var o,a,r,s,c,d=this,u=!1;this.json={},this.progress=0,this.IsLoading=function(){return u},this.Load=function(e,d,h,f){u||(u=!0,o=d,a=h,r=f,s=e,c=new XMLHttpRequest,c.onprogress=i,c.open("GET",e,!0),c.onload=t,c.onerror=n,c.send(null))}};var AM=AM||{};AM.LoadingManager=function(){function e(e){for(var t=0,n=e.length;n>t;++t)e[t]()}var t=[],n=[],i=0;this.Start=function(t){t=t||1,i+=t,e(n)},this.End=function(o){o=o||1,i>0&&(i-=o,e(n)),0>=i&&(i=0,e(t),t.length=0,n.length=0)},this.OnEnd=function(e){i>0?t.push(e):e()},this.OnProgress=function(e){i>0?n.push(e):e()},this.IsLoading=function(){return i>0},this.GetRemaining=function(){return i}};var AM=AM||{};!function(){var e=function(){"use strict";function e(){this.start_time=0,this.stop_time=0,this.run_time=0,this.running=!1}return e.prototype.start=function(){this.start_time=(new Date).getTime(),this.running=!0},e.prototype.stop=function(){this.stop_time=(new Date).getTime(),this.run_time=this.stop_time-this.start_time,this.running=!1},e.prototype.get_runtime=function(){return this.run_time},e.prototype.reset=function(){this.run_time=0},e}(),t=function(){"use strict";function e(e){this.arr=new Int32Array(e),this.begin=0,this.end=-1,this.num_el=0,this.arr_size=e}return e.prototype.push_back=function(e){this.num_el<this.arr_size?(this.end++,this.arr[this.end]=e,this.num_el++):(this.end=(this.end+1)%this.arr_size,this.begin=(this.begin+1)%this.arr_size,this.arr[this.end]=e)},e.prototype.get=function(e){return this.arr[(this.begin+e)%this.arr_size]},e.prototype.size=function(){return this.num_el},e}(),n=function(){"use strict";function n(){this.fps=0,this.timers=[],this.frame_timer=new e}var i=0,o=new t(20);return n.prototype.add=function(t){this.timers.push([t,new e])},n.prototype.new_frame=function(){++i;var e=0,t=0|this.timers.length;for(e=0;t>e;++e){var n=this.timers[e][1];n.reset()}if(i>=1){this.frame_timer.stop(),o.push_back(this.frame_timer.get_runtime());var a=o.size(),r=0;for(e=0;a>e;++e)r+=o.get(e);this.fps=a/r*1e3,this.frame_timer.start()}},n.prototype.find_task=function(e){var t=0|this.timers.length,n=0;for(n=0;t>n;++n){var i=this.timers[n];if(i[0]===e)return i}return null},n.prototype.start=function(e){var t=this.find_task(e);t[1].start()},n.prototype.stop=function(e){var t=this.find_task(e);t[1].stop()},n.prototype.log=function(){var e=0|this.timers.length,t=0,n="<strong>FPS: "+this.fps.toFixed(2)+"</strong>";for(t=0;e>t;++t){var i=this.timers[t];n+="<br/>"+i[0]+": "+i[1].get_runtime()+"ms"}return n},n.prototype.log2=function(){var e=0|this.timers.length,t=0,n="FPS: "+this.fps.toFixed(2)+"  ";for(t=0;e>t;++t){var i=this.timers[t];n+=i[0]+": "+i[1].get_runtime()+"ms  "}return n},n}();AM.Profiler=n}();var AM=AM||{};AM.DeviceLockScreenOrientation=function(){function e(){window.cordova?(t(),r=!0):s=!1}function t(){for(var e=0,t=c.length;t>e;++e)c[e]();c.length=0}function n(e){s&&(r?e():c.push(e))}function i(){screen.lockOrientation("landscape-primary")}function o(){screen.lockOrientation("portrait-primary")}function a(){screen.unlockOrientation()}var r=!1,s=!0,c=[];document.addEventListener("deviceready",e,!1),this.LockLandscape=function(){n(i)},this.LockPortrait=function(){n(o)},this.Unlock=function(){n(a)}};var AM=AM||{};AM.DeviceOrientationControl=function(e){var t=this;this.object=e,this.object.rotation.reorder("YXZ");var n=!1,i=!1,o=0,a=new this.CoefMethod,r=function(e){n?(a.OnOrientationChange(e),i=!0):n=!0},s=function(){o=window.orientation||0};this.Connect=function(){s(),window.addEventListener("orientationchange",s,!1),window.addEventListener("deviceorientation",r,!1)},this.Disconnect=function(){window.removeEventListener("orientationchange",s,!1),window.removeEventListener("deviceorientation",r,!1),i=!1},this.Update=function(){var e=function(){var e=new THREE.Vector3(0,0,1),t=new THREE.Euler,n=new THREE.Quaternion,i=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(o,a,r,s,c){t.set(r,a,-s,"YXZ"),o.setFromEuler(t),o.multiply(i),o.multiply(n.setFromAxisAngle(e,-c))}}();if(i){var n=o?THREE.Math.degToRad(o):0;a.Update(),e(t.object.quaternion,a.alpha,a.beta,a.gamma,n)}}},AM.DeviceOrientationControl.prototype.PowerMethod=function(){function e(e,t,n){var i=AM.DeviceOrientationControl.prototype.Mod2Pi(t-e),o=Math.sign(i),a=Math.abs(i/Math.PI);return a=Math.pow(a,n),AM.DeviceOrientationControl.prototype.Mod2Pi(e+a*Math.PI*o)}var t,n=this,i=2;this.alpha=0,this.beta=0,this.gamma=0,this.OnOrientationChange=function(e){t=e},this.Update=function(){n.alpha=e(n.alpha,THREE.Math.degToRad(t.alpha),i),n.beta=e(n.beta,THREE.Math.degToRad(t.beta),i),n.gamma=e(n.gamma,THREE.Math.degToRad(t.gamma),i)}},AM.DeviceOrientationControl.prototype.CoefMethod=function(){function e(e,t,n){return e+AM.DeviceOrientationControl.prototype.Mod2Pi(t-e)*n}var t=this;this.coef=.2,this.alpha=0,this.beta=0,this.gamma=0;var n=!1;this.OnOrientationChange=function(e){n=e},this.Update=function(){if(n){var i=e(t.alpha,THREE.Math.degToRad(n.alpha),t.coef),o=e(t.beta,THREE.Math.degToRad(n.beta),t.coef),a=e(t.gamma,THREE.Math.degToRad(n.gamma),t.coef);t.alpha=i,t.beta=o,t.gamma=a}}},AM.DeviceOrientationControl.prototype.AverageMethod=function(){var e=this;this.history=[],this.history_max=10,this.alpha=0,this.beta=0,this.gamma=0,this.OnOrientationChange=function(t){e.history.length>e.history_max&&e.history.shift(),e.history.push(t)},this.Update=function(t,n,i){var t=0,n=0,i=0;if(0!=e.history.length){for(var o=0,a=e.history.length;a>o;o++)t+=AM.DeviceOrientationControl.prototype.Mod360(e.history[o].alpha),n+=AM.DeviceOrientationControl.prototype.Mod360(e.history[o].beta),i+=AM.DeviceOrientationControl.prototype.Mod360(e.history[o].gamma);t/=e.history.length,n/=e.history.length,i/=e.history.length,e.alpha=THREE.Math.degToRad(t),e.beta=THREE.Math.degToRad(n),e.gamma=THREE.Math.degToRad(i)}}},AM.DeviceOrientationControl.prototype.Mod2Pi=function(){var e=Math.PI,t=2*Math.PI;return function(n){if(n>e){do n-=t;while(n>e)}else if(-e>n)do n+=t;while(-e>n);return n}}(),AM.DeviceOrientationControl.prototype.Mod360=function(e){return e%=360,180>e?e:e-360};var AM=AM||{};AM.GeographicCoordinatesConverter=function(e,t){var n=this,i={latitude:0,longitude:0};this.GetLocalCoordinates=function(e,t){var o=(i.latitude+e)/2,a={x:0,y:0};return a.x=(t-i.longitude)*n.EARTH_RADIUS*Math.cos(o),a.y=(e-i.latitude)*-n.EARTH_RADIUS,a},this.GetLocalCoordinatesFromDegres=function(e,t){return n.GetLocalCoordinates(THREE.Math.degToRad(e),THREE.Math.degToRad(t))},this.SetOrigin=function(e,t){i.latitude=e,i.longitude=t},this.SetOriginFromDegres=function(e,t){i.latitude=THREE.Math.degToRad(e),i.longitude=THREE.Math.degToRad(t)},this.GetOrigin=function(){return i},this.SetOrigin(e||0,t||0)},AM.GeographicCoordinatesConverter.prototype.EARTH_RADIUS=6371e3;var AM=AM||{};AM.GeolocationControl=function(e,t){function n(e){r.copy(c.GetLocalCoordinatesFromDegres(e.coords.latitude,e.coords.longitude)),a=!0}function i(e){console.warn("geolocation failed: "+e.message),window.setTimeout(o.Connect,o.retry_connection_ms)}var o=this,a=!1,r=new THREE.Vector3,s=0,c=t,d=.1;this.object=e,this.interpolation_coefficient=.02,this.retry_connection_ms=1e3,this.Connect=function(){s=navigator.geolocation.watchPosition(n,i)},this.Disconnect=function(){navigator.geolocation.clearWatch(s),a=!1},this.Update=function(){if(a){var e=r.x-o.object.position.x,t=r.z-o.object.position.z,n=e*e+t*t;d*d>n?a=!1:(e*=o.interpolation_coefficient,t*=o.interpolation_coefficient,o.object.position.x+=e,o.object.position.z+=t)}}};var AMTHREE=AMTHREE||{};"undefined"!=typeof THREE?(AMTHREE.GifTexture=function(e){THREE.Texture.call(this),this.minFilter=THREE.NearestMipMapNearestFilter,this.imageElement=document.createElement("img");var t=document.getElementsByTagName("script");t=t[t.length-1],t.parentNode.appendChild(this.imageElement),this.imageElement.width=this.imageElement.naturalWidth,this.imageElement.height=this.imageElement.naturalHeight,e&&this.setGif(e)},AMTHREE.GifTexture.prototype=Object.create(THREE.Texture.prototype),AMTHREE.GifTexture.prototype.constructor=AMTHREE.GifTexture,AMTHREE.GifTexture.prototype.play=function(){this.anim.play(),this.image=this.gifCanvas},AMTHREE.GifTexture.prototype.update=function(){this.needsUpdate=!0},AMTHREE.GifTexture.prototype.stop=function(){this.anim.move_to(0),this.image=void 0},AMTHREE.GifTexture.prototype.pause=function(){this.anim.pause()},AMTHREE.GifTexture.prototype.setGif=function(e){this.imageElement.src=e,this.anim=new SuperGif({gif:this.imageElement,auto_play:!1}),this.anim.load(),this.gifCanvas=this.anim.get_canvas(),this.gifCanvas.style.display="none"}):console.warn("GifTexture.js: THREE undefined");var AMTHREE=AMTHREE||{};"undefined"!=typeof THREE?AMTHREE.ObjectLoader=function(e){var t=this;this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.constants={},this.geometries={},this.materials={},this.animations=[],this.images={},this.videos={},this.textures={},this.json={},this.root;var n=[];this.Load=function(e,n){var i=new THREE.XHRLoader(t.manager);i.load(e,function(e){return function(n){t.json=JSON.parse(n),e(t.Parse(t.json))}}(n))},this.Parse=function(e){t.json=e,t.ParseConstants(e.constants),t.ParseGeometries(e.geometries),t.ParseImages(e.images),t.ParseVideos(e.videos),t.ParseTextures(e.textures),t.ParseMaterials(e.materials),t.ParseAnimations(e.animations);var n=t.ParseObject(e.object);return n.animations=t.animations,n},this.ParseConstants=function(e){data=void 0!==e?e:{},t.constants.asset_path=t.root?t.root+"/":"",data.asset_path&&(t.constants.asset_path=t.constants.asset_path+data.asset_path+"/"),t.constants.image_path=t.constants.asset_path+(void 0!==data.image_path?data.image_path:""),t.constants.video_path=t.constants.asset_path+(void 0!==data.video_path?data.video_path:""),t.constants.model_path=t.constants.asset_path+(void 0!==data.model_path?data.model_path:"")},this.ParseMaterials=function(e){if(void 0!==e){var n=new THREE.MaterialLoader;n.setTextures(t.textures);for(var i=0,o=e.length;o>i;i++){var a=n.parse(e[i]);t.materials[a.uuid]=a}}},this.ParseAnimations=function(e){if(void 0!==e){t.animations=[];for(var n=0;n<e.length;n++){var i=THREE.AnimationClip.parse(e[n]);t.animations.push(i)}}},this.ParseImages=function(e){function n(e){return t.manager.itemStart(e),o.load(e,function(){t.manager.itemEnd(e)})}if(void 0!==e&&e.length>0)for(var i=new THREE.LoadingManager,o=new THREE.ImageLoader(i),a=0,r=e.length;r>a;a++){var s=e[a];if(void 0===s.url)console.warn('AMTHREE.ObjectLoader: no "url" specified for image '+a);else if(void 0===s.uuid)console.warn('AMTHREE.ObjectLoader: no "uuid" specified for image '+a);else{var c=t.constants.image_path+"/"+s.url;t.images[s.uuid]=n(c)}}},this.ParseVideos=function(e){if(void 0!==e)for(var n=0,i=e.length;i>n;n++){var o=e[n];if(void 0===o.url)console.warn('AMTHREE.ObjectLoader: no "url" specified for video '+n);else if(void 0===o.uuid)console.warn('AMTHREE.ObjectLoader: no "uuid" specified for video '+n);else{var a={url:t.constants.video_path+"/"+o.url,uuid:o.uuid,width:o.width||640,height:o.height||480};t.videos[o.uuid]=a}}},this.ParseTextures=function(e){function i(e){return"number"==typeof e?e:(console.warn("AMTHREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),THREE[e])}if("undefined"==typeof SuperGif&&console.warn("AMTHREE.ObjectLoader: SuperGif is undefined"),void 0!==e)for(var o=0,a=e.length;a>o;o++){var r=e[o];if(void 0!==r.image||void 0!==r.video){if(void 0!==r.image){if(void 0===t.images[r.image]){console.warn("AMTHREE.ObjectLoader: Undefined image",r.image);continue}var s=t.images[r.image];if(void 0!==r.animated&&r.animated){if("undefined"==typeof SuperGif)continue;var c=new AMTHREE.GifTexture(s.src),d=function(e){return function(){e.needsUpdate=!0}}(c);n.push(d)}else{var c=new THREE.Texture(s);c.needsUpdate=!0}}else{if(void 0===t.videos[r.video]){console.warn("AMTHREE.ObjectLoader: Undefined video",r.video);continue}var u=t.videos[r.video],c=new AMTHREE.VideoTexture({src:u.url,width:u.width,height:u.height,loop:r.loop,autoplay:r.autoplay}),h=function(e){return function(){e.update()}}(c);n.push(h)}c.uuid=r.uuid,void 0!==r.name&&(c.name=r.name),void 0!==r.mapping&&(c.mapping=i(r.mapping)),void 0!==r.offset&&(c.offset=new THREE.Vector2(r.offset[0],r.offset[1])),void 0!==r.repeat&&(c.repeat=new THREE.Vector2(r.repeat[0],r.repeat[1])),void 0!==r.minFilter?c.minFilter=i(r.minFilter):c.minFilter=THREE.LinearFilter,void 0!==r.magFilter&&(c.magFilter=i(r.magFilter)),void 0!==r.anisotropy&&(c.anisotropy=r.anisotropy),Array.isArray(r.wrap)&&(c.wrapS=i(r.wrap[0]),c.wrapT=i(r.wrap[1])),t.textures[r.uuid]=c}else console.warn('AMTHREE.ObjectLoader: No "image" nor "video" specified for',r.uuid)}},this.ParseGeometries=function(e){if(void 0!==e)for(var n=new THREE.JSONLoader,i=new THREE.BufferGeometryLoader,o=0,a=e.length;a>o;o++){var r,s=e[o];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":r=new THREE[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"CubeGeometry":r=new THREE.BoxGeometry(s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleBufferGeometry":r=new THREE.CircleBufferGeometry(s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CircleGeometry":r=new THREE.CircleGeometry(s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":r=new THREE.CylinderGeometry(s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":r=new THREE.SphereGeometry(s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"SphereBufferGeometry":r=new THREE.SphereBufferGeometry(s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":r=new THREE.DodecahedronGeometry(s.radius,s.detail);break;case"IcosahedronGeometry":r=new THREE.IcosahedronGeometry(s.radius,s.detail);break;case"OctahedronGeometry":r=new THREE.OctahedronGeometry(s.radius,s.detail);break;case"TetrahedronGeometry":r=new THREE.TetrahedronGeometry(s.radius,s.detail);break;case"RingGeometry":r=new THREE.RingGeometry(s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":r=new THREE.TorusGeometry(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":r=new THREE.TorusKnotGeometry(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.p,s.q,s.heightScale);break;case"BufferGeometry":r=i.parse(s);break;case"Geometry":r=n.parse(s.data,this.texturePath).geometry;break;default:console.warn('AMTHREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}r.uuid=s.uuid,void 0!==s.name&&(r.name=s.name),t.geometries[s.uuid]=r}},this.ParseObject=function(){function n(e,t){var n=new THREE.Matrix4;e.uuid=t.uuid,void 0!==t.name&&(e.name=t.name),void 0!==t.matrix?(n.fromArray(t.matrix),n.decompose(e.position,e.quaternion,e.scale)):(void 0!==t.position&&e.position.fromArray(t.position),void 0!==t.rotation&&e.rotation.fromArray(t.rotation),void 0!==t.scale&&e.scale.fromArray(t.scale),void 0!==t.scaleXYZ&&(e.scale.x*=t.scaleXYZ,e.scale.y*=t.scaleXYZ,e.scale.z*=t.scaleXYZ)),void 0!==t.castShadow&&(e.castShadow=t.castShadow),void 0!==t.receiveShadow&&(e.receiveShadow=t.receiveShadow),void 0!==t.visible&&(e.visible=t.visible),void 0!==t.userData&&(e.userData=t.userData)}if(THREE.ColladaLoader){var i=new THREE.ColladaLoader;i.options.convertUpAxis=!0}else console.warn("AMTHREE.ObjectLoader: THREE.ColladaLoader undefined");if(THREE.OBJLoader)var o=new THREE.OBJLoader;else console.warn("AMTHREE.ObjectLoader: THREE.OBJLoader undefined");if(THREE.OBJMTLLoader)var a=new THREE.OBJMTLLoader;else console.warn("AMTHREE.ObjectLoader: THREE.OBJMTLLoader undefined");return function(r,s){function c(e){return void 0!==e?(void 0===t.geometries[e]&&console.warn("AMTHREE.ObjectLoader: Undefined geometry",e),t.geometries[e]):void 0}function d(e){return void 0!==e?(void 0===t.materials[e]&&console.warn("AMTHREE.ObjectLoader: Undefined material",e),t.materials[e]):void 0}var u;switch(r.type){case"Scene":u=new THREE.Scene;break;case"PerspectiveCamera":u=new THREE.PerspectiveCamera(r.fov,r.aspect,r.near,r.far);break;case"OrthographicCamera":u=new THREE.OrthographicCamera(r.left,r.right,r.top,r.bottom,r.near,r.far);break;case"AmbientLight":u=new THREE.AmbientLight(r.color);break;case"DirectionalLight":u=new THREE.DirectionalLight(r.color,r.intensity);break;case"PointLight":u=new THREE.PointLight(r.color,r.intensity,r.distance,r.decay);break;case"SpotLight":u=new THREE.SpotLight(r.color,r.intensity,r.distance,r.angle,r.exponent,r.decay);break;case"HemisphereLight":u=new THREE.HemisphereLight(r.color,r.groundColor,r.intensity);break;case"Mesh":u=new THREE.Mesh(c(r.geometry),d(r.material));break;case"LOD":u=new THREE.LOD;break;case"Line":u=new THREE.Line(c(r.geometry),d(r.material),r.mode);break;case"PointCloud":case"Points":u=new THREE.Points(c(r.geometry),d(r.material));break;case"Sprite":u=new THREE.Sprite(d(r.material));break;case"Group":u=new THREE.Group;break;case"OBJ":if("undefined"==typeof o)return void console.warn("AMTHREE.ObjectLoader: failed to load "+r.uuid+": THREE.OBJLoader is undefined");u=new THREE.Object3D;var h=t.constants.model_path+"/"+r.url;t.manager.itemStart(h),o.load(h,function(e,t,i,o){return function(a){e.copy(a),e.traverse(function(e){e.geometry&&e.geometry.computeBoundingSphere()}),n(e,t),i.itemEnd(o)}}(u,r,t.manager,h));break;case"OBJMTL":if("undefined"==typeof a)return void console.warn("AMTHREE.ObjectLoader: failed to load "+r.uuid+": THREE.OBJMTLLoader is undefined");u=new THREE.Group;var f=t.constants.model_path+"/"+r.objUrl,l=t.constants.model_path+"/"+r.mtlUrl;t.manager.itemStart(f),t.manager.itemStart(l),a.load(f,l,function(e,t,i,o,a){return function(r){e.copy(r),e.traverse(function(e){e.geometry&&e.geometry.computeBoundingSphere()}),n(e,t),i.itemEnd(o),i.itemEnd(a)}}(u,r,t.manager,f,l));break;case"Collada":if("undefined"==typeof i)return void console.warn("ObjectLoader: failed to load "+r.uuid+": THREE.ColladaLoader is undefined");u=new THREE.Group;var h=t.constants.model_path+"/"+r.url;t.manager.itemStart(h),i.load(h,function(e,t,i,o){return function(a){var r=a.scene;e.copy(r),"undefined"!=typeof THREE.Animation&&e.traverse(function(e){if(e instanceof THREE.SkinnedMesh){var t=new THREE.Animation(e,e.geometry.animation);t.play()}}),n(e,t),i.itemEnd(o)}}(u,r,e,h));case"Sound":u=new AMTHREE.Sound(r.src);break;default:u=new THREE.Object3D}if(n(u,r),void 0!==r.children)for(var m in r.children){var p=t.ParseObject(r.children[m],u);void 0!==p&&u.add(p)}if("LOD"===r.type)for(var E=r.levels,v=0;v<E.length;v++){var g=E[v],m=u.getObjectByProperty("uuid",g.object);void 0!==m&&u.addLevel(m,g.distance)}return void 0!==s&&s.add(u),u}}(),this.GetOnUpdateCallbacks=function(){return n}}:console.warn("ObjectLoader.js: THREE undefined");var AMTHREE=AMTHREE||{};"undefined"!=typeof THREE?AMTHREE.Scene=function(e){function t(){s.aspect=window.innerWidth/window.innerHeight,s.updateProjectionMatrix(),a.setSize(window.innerWidth,window.innerHeight)}function n(e){if(o.gps_converter&&void 0!==e.userData&&void 0!==e.position){var t=e.userData;if(void 0!==t.latitude&&void 0!==t.longitude){var n=o.gps_converter(t.latitude,t.longitude);e.position.z=n.y,e.position.x=n.x}void 0!==t.altitude&&(e.position.y=t.altitude)}}"undefined"==typeof AMTHREE.ObjectLoader&&console.warn("AMTHREE.Scene: AMTHREE.ObjectLoader undefined"),e=e||{};var i,o=this,a=new THREE.WebGLRenderer({alpha:!0,canvas:e.canvas}),r=new THREE.Scene,s=new THREE.PerspectiveCamera(e.fov||80,a.domElement.width/a.domElement.height,1e-4,1e4),c=new THREE.Object3D,d=new THREE.LoadingManager;c.add(s),r.add(c),e.canvas||(a.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(a.domElement)),a.setClearColor(10066383,0),"undefined"!=typeof AMTHREE.ObjectLoader&&(i=new AMTHREE.ObjectLoader(d)),this.gps_converter=e.gps_converter,this.Clear=function(){r.children=[],r.copy(new THREE.Scene,!1)},this.SetFullWindow=function(){window.addEventListener("resize",t,!1),t()},this.StopFullWindow=function(){window.removeEventListener("resize",t,!1)},this.Render=function(){a.render(r,s)},this.Update=function(){var e=new THREE.Clock;return function(){for(var t=i.GetOnUpdateCallbacks(),n=0,o=t.length;o>n;++n)t[n]();THREE.AnimationHandler&&THREE.AnimationHandler.update(e.getDelta()),r.traverse(function(e){e instanceof THREE.Mesh&&e.material&&e.material.map&&e.material.map.update&&e.material.map.update()})}}(),this.AddObject=function(e){n(e),r.add(e)},this.RemoveObject=function(e){r.remove(e)};var u=function(e){return function(t){var n=function(t){return function(){for(;t.children.length;){var n=t.children[0];t.remove(n),o.AddObject(n)}r.copy(t,!1),AMTHREE.PlayAnimations(r),e&&e()}}(t);d.onLoad=n}};this.Parse=function(e,t){if(i){var n=new u(t),o=i.parse(e);n(o)}else console.warn("AMTHREE.Scene: Parse failed: AMTHREE.ObjectLoader undefined")},this.Load=function(e,t){i?i.Load(e,new u(t)):console.warn("AMTHREE.Scene: Load failed: AMTHREE.ObjectLoader undefined")},this.GetCamera=function(){return s},this.GetCameraBody=function(){return c},this.GetScene=function(){return r},this.GetRenderer=function(){return a},this.ResizeRenderer=function(e,t){a.setSize(e,t),s.aspect=a.domElement.width/a.domElement.height,s.updateProjectionMatrix()}}:console.warn("Scene.js: THREE undefined");var AMTHREE=AMTHREE||{};"undefined"!=typeof THREE?(AMTHREE.Sound=function(e){THREE.Object3D.call(this),this.src=e,this.audio=new Audio,this.audio.loop=!0,this.playing=!1},AMTHREE.Sound.prototype=Object.create(THREE.Object3D.prototype),AMTHREE.Sound.prototype.constructor=AMTHREE.Sound,AMTHREE.Sound.prototype.play=function(){this.playing=!0,this.audio.src=this.src,this.audio.play()},AMTHREE.Sound.prototype.stop=function(){this.audio.src="",this.playing=!1},AMTHREE.Sound.prototype.pause=function(){this.audio.pause(),this.playing=!1},AMTHREE.Sound.prototype.setSrc=function(e){this.src=e,this.isPlaying()&&this.play()},AMTHREE.Sound.prototype.isPlaying=function(){return this.playing},AMTHREE.Sound.prototype.clone=function(){return new AMTHREE.Sound(this.src)},AMTHREE.Sound.prototype.copy=function(e){this.setSrc(e.src)},AMTHREE.SoundsCall=function(e,t){e.traverse(function(e){e instanceof AMTHREE.Sound&&e[t]&&e[t]()})},AMTHREE.PlaySounds=function(e){AMTHREE.SoundsCall(e,"play")},AMTHREE.PauseSounds=function(e){AMTHREE.SoundsCall(e,"pause")},AMTHREE.StopSounds=function(e){AMTHREE.SoundsCall(e,"stop")}):console.warn("Sound.js: THREE undefined");var AMTHREE=AMTHREE||{};"undefined"!=typeof THREE?(AMTHREE.TrackedObjManager=function(e){e=e||{};var t=this,n=new THREE.Clock(!0),i=new AMTHREE.TrackedObjManager.prototype.Holder;this.camera=e.camera,this.lerp_factor=e.lerp_factor||.2,this.timeout=e.timeout||6,this.UpdateLerpMethod=function(){i.ForEach(function(e){if(e.enabled){var n=e.object,i=e.target;n.position.lerp(i.position,t.lerp_factor),n.quaternion.slerp(i.quaternion,t.lerp_factor),n.scale.lerp(i.scale,t.lerp_factor)}})},this.update_method=this.UpdateLerpMethod,this.Add=function(e,t,n,o){i.Add(e,t,n,o)},this.Remove=function(e){i.Remove(e)},this.Clear=function(){i.Clear()},this.Update=function(){i.UpdateElapsed(n.getDelta()),i.CheckTimeout(t.timeout),t.update_method()},this.Track=function(){var e=new THREE.Matrix4;return function(n,o){if(t.camera){var a=i.Get(n);if(a){var r=a.target;return e.copy(t.camera.matrixWorld),e.multiply(o),e.decompose(r.position,r.quaternion,r.scale),a.enabled||e.decompose(a.object.position,a.object.quaternion,a.object.scale),i.Track(n),!0}console.warn("TrackedObjManager: object "+n+" not found")}else console.warn("TrackedObjManager: camera is undefined");return!1}}(),this.TrackCompose=function(){var e=new THREE.Matrix4;return function(n,i,o,a){return e.compose(i,o,a),t.Track(n,e)}}(),this.TrackComposePosit=function(){var e=new THREE.Vector3,n=new THREE.Euler,i=new THREE.Quaternion,o=new THREE.Vector3;return function(a,r,s,c){return e.x=r[0],e.y=r[1],e.z=-r[2],n.x=-Math.asin(-s[1][2]),n.y=-Math.atan2(s[0][2],s[2][2]),n.z=Math.atan2(s[1][0],s[1][1]),o.x=c,o.y=c,o.z=c,i.setFromEuler(n),t.TrackCompose(a,e,i,o)}}(),this.GetObject=function(e){var t=i.get(e);return t?t.object:void 0}},AMTHREE.TrackedObjManager.prototype.Holder=function(){var e=this,t={};this.Add=function(e,n,i,o){t[n]={object:e,target:{position:e.position.clone(),quaternion:e.quaternion.clone(),scale:e.scale.clone()},elapsed:0,on_enable:i,on_disable:o,enabled:!1}},this.Remove=function(e){var n=t[e];n.enabled&&n.on_disable&&n.on_disable(n.object),delete t[e]},this.Clear=function(){for(uuid in t)e.Remove(uuid)},this.Track=function(e){var n=t[e];n.elapsed=0,n.enabled||(n.enabled=!0,n.on_enable&&n.on_enable(n.object))},this.UpdateElapsed=function(e){for(uuid in t)t[uuid].elapsed+=e},this.CheckTimeout=function(e){for(uuid in t){var n=t[uuid];n.enabled&&n.elapsed>e&&(n.on_disable&&n.on_disable(n.object),n.enabled=!1)}},this.ForEach=function(e){for(uuid in t)e(t[uuid])},this.Get=function(e){return t[e]}}):console.warn("TrackedObjManager.js: THREE undefined");var AMTHREE=AMTHREE||{};"undefined"!=typeof THREE?(AMTHREE.AnimatedTextureCall=function(e,t){e.traverse(function(e){e.material&&e.material.map&&e.material.map[t]&&e.material.map[t]()})},AMTHREE.PlayAnimatedTextures=function(e){AMTHREE.AnimatedTextureCall(e,"play")},AMTHREE.StopAnimatedTextures=function(e){AMTHREE.AnimatedTextureCall(e,"stop")},AMTHREE.PauseAnimatedTextures=function(e){AMTHREE.AnimatedTextureCall(e,"pause")},AMTHREE.UpdateAnimatedTextures=function(e){AMTHREE.AnimatedTextureCall(e,"update")},AMTHREE.WorldToCanvasPosition=function(){var e=new THREE.Vector3;return function(t,n,i){e.copy(t),e.project(n);var o=Math.round((e.x+1)*i.width/2),a=Math.round((-e.y+1)*i.height/2);return{x:o,y:a,z:e.z}}}(),AMTHREE.PlayAnimations=function(e){e.traverse(function(e){if(e instanceof THREE.SkinnedMesh){var t=new THREE.Animation(e,e.geometry.animation);t.play()}})}):console.warn("utility.js: THREE undefined");var AMTHREE=AMTHREE||{};"undefined"!=typeof THREE?(AMTHREE.VideoTexture=function(e){THREE.Texture.call(this),this.minFilter=THREE.NearestMipMapNearestFilter,this.videoElement=document.createElement("video"),this.setVideo(e)},AMTHREE.VideoTexture.prototype=Object.create(THREE.Texture.prototype),AMTHREE.VideoTexture.prototype.constructor=AMTHREE.VideoTexture,AMTHREE.VideoTexture.prototype.copy=function(e){THREE.Texture.prototype.copy.call(this,e);var t={};return e.videoElement&&(t.width=e.videoElement.width,t.height=e.videoElement.height,t.loop=e.videoElement.loop,t.autoplay=e.videoElement.autoplay),t.src=e.src,this.setVideo(t),this},AMTHREE.VideoTexture.prototype.clone=function(){return(new this.constructor).copy(this)},AMTHREE.VideoTexture.prototype.play=function(){this.videoElement&&!this.playing&&(this.paused||(this.videoElement.src=this.src),this.videoElement.play(),this.image=this.videoElement,this.playing=!0)},AMTHREE.VideoTexture.prototype.update=function(){this.videoElement&&this.videoElement.readyState==this.videoElement.HAVE_ENOUGH_DATA&&(this.needsUpdate=!0)},AMTHREE.VideoTexture.prototype.pause=function(){this.videoElement&&!this.videoElement.paused&&(this.videoElement.pause(),this.playing=!1)},AMTHREE.VideoTexture.prototype.stop=function(){this.videoElement&&(this.pause(),this.videoElement.src="",this.image=void 0,this.needsUpdate=!0)},AMTHREE.VideoTexture.prototype.setVideo=function(e){this.stop(),e&&(this.src=e.src,this.videoElement.width=e.width,this.videoElement.height=e.height,this.videoElement.autoplay="undefined"!=typeof e.autoplay?e.autoplay:!1,this.videoElement.loop="undefined"!=typeof e.loop?e.loop:!0),this.playing=!1,this.videoElement.autoplay&&this.play()}):console.warn("VideoTexture.js: THREE undefined");var AM=AM||{};AM.Detection=function(){function e(e,t){var i=e*t;if(i>n.length)for(;--i>=0;)n[i]=new jsfeat.keypoint_t(0,0,0,0,-1)}var t={laplacian_threshold:30,eigen_threshold:25,detection_corners_max:500,border_size:3,fast_threshold:40},n=[],i=0,o=0,a=0,r=new jsfeat.matrix_t(32,t.detection_corners_max,jsfeat.U8_t|jsfeat.C1_t);this.Detect=function(s){o=s.cols,a=s.rows,e(o,a),i=AM.DetectKeypointsYape06(s,n,t.detection_corners_max,t.laplacian_threshold,t.eigen_threshold),jsfeat.orb.describe(s,n,i,r)},this.SetParameters=function(e){for(name in e)"undefined"!=typeof t[name]&&(t[name]=e[name])},this.GetDescriptors=function(){return r},this.GetNumCorners=function(){return i},this.GetCorners=function(){return n},this.GetImageWidth=function(){return o},this.GetImageHeight=function(){return a}},AM.IcAngle=function(){var e=new Int32Array([15,15,15,15,14,14,14,13,13,12,11,10,9,8,6,3,0]);return function(t,n,i){var o=15,a=0,r=0,s=t.data,c=t.cols,d=0,u=0,h=i*c+n|0,f=0,l=0,m=0,p=0;for(d=-o;o>=d;++d)r+=d*s[h+d];
for(u=1;o>=u;++u){for(f=0,l=e[u],d=-l;l>=d;++d)m=s[h+d+u*c],p=s[h+d-u*c],f+=m-p,r+=d*(m+p);a+=u*f}return Math.atan2(a,r)}}(),AM.DetectKeypointsPostProc=function(e,t,n,i){n>i&&(jsfeat.math.qsort(t,0,n-1,function(e,t){return t.score<e.score}),n=i);for(var o=0;n>o;++o)t[o].angle=AM.IcAngle(e,t[o].x,t[o].y);return n},AM.DetectKeypointsYape06=function(e,t,n,i,o){jsfeat.yape06.laplacian_threshold=i,jsfeat.yape06.min_eigen_value_threshold=o;var a=jsfeat.yape06.detect(e,t,17);return a=AM.DetectKeypointsPostProc(e,t,a,n)},AM.DetectKeypointsFast=function(e,t,n,i,o){jsfeat.fast_corners.set_threshold(i);var a=jsfeat.fast_corners.detect(e,t,o||3);return a=AM.DetectKeypointsPostProc(e,t,a,n)};var AM=AM||{};AM.ImageFilter=function(){var e,t,n={blur_size:3,blur:!0};this.Filter=function(i){var o=i.width,a=i.height;e?e.resize(o,a,jsfeat.U8_t|jsfeat.C1_t):e=new jsfeat.matrix_t(o,a,jsfeat.U8_t|jsfeat.C1_t),t?t.resize(o,a,jsfeat.U8_t|jsfeat.C1_t):t=new jsfeat.matrix_t(o,a,jsfeat.U8_t|jsfeat.C1_t),jsfeat.imgproc.grayscale(i.data,o,a,e),n.blur&&jsfeat.imgproc.gaussian_blur(e,t,n.blur_size)},this.SetMaxImageSize=function(e){_image_size_max=e},this.SetBlurSize=function(e){_blur_size=e},this.GetFilteredImage=function(){return n.blur?t:e},this.SetParameters=function(e){for(name in e)"undefined"!=typeof n[name]&&(n[name]=e[name])}};var AM=AM||{};AM.MarkerTracker=function(){var e,t=new AM.Training,n={},i=new AM.ImageFilter,o=new AM.Detection,a=new AM.Matching,r=new AM.Pose,s=!1,c={match_min:8},d=new AM.Profiler;d.add("filter"),d.add("detection"),d.add("matching"),d.add("pose"),this.ComputeImage=function(e){d.new_frame(),d.start("filter"),i.Filter(e),d.stop("filter"),d.start("detection"),o.Detect(i.GetFilteredImage()),d.stop("detection")},this.Match=function(){d.start("matching"),s=!1,e=void 0,a.SetScreenDescriptors(o.GetDescriptors());for(uuid in n){var t=n[uuid];if(t.IsActive()){a.Match(t.GetDescriptorsLevels());var i=a.GetNumMatches();if(s=i>=c.match_min){var u=r.Pose(a.GetMatches(),i,o.GetCorners(),t.GetCornersLevels());if(s=u>=c.match_min){e=t;break}}}}return d.stop("matching"),s},this.GetMatchUuid=function(){return e.GetUuid()},this.GetPose=function(){if(s){d.start("pose");var t=r.GetPoseCorners(e.GetWidth(),e.GetHeight());return d.stop("pose"),t}},this.AddMarker=function(e,i){t.Train(e);var o=new AM.TrainedImage(i);t.SetResultToTrainedImage(o),t.Empty(),n[i]=o},this.RemoveMarker=function(e){n[e]&&delete n[e]},this.ActiveMarker=function(e,t){n[e]&&n[e].Active(t)},this.ActiveAllMarkers=function(e){for(uuid in n)n[uuid].Active(e)},this.ClearMarkers=function(){n={}},this.GetScreenCorners=function(){return o.GetCorners()},this.GetNumScreenCorners=function(){return o.GetNumCorners()},this.Log=function(){console.log(d.log())},this.SetParameters=function(e){for(name in e)"undefined"!=typeof c[name]&&(c[name]=e[name]);t.SetParameters(e),i.SetParameters(e),o.SetParameters(e),a.SetParameters(e)}};var AM=AM||{};AM.Matching=function(){var e,t,n=[],i={match_threshold:48};this.SetScreenDescriptors=function(t){e=t},this.Match=function(o){function a(e){return e-=e>>1&1431655765,e=(858993459&e)+(e>>2&858993459),16843009*(e+(e>>4)&252645135)>>24}function r(e,t){var o=e.rows,r=e.buffer.i32,s=0,c=0;n.length=0;for(var d=0;o>d;++d){for(var u=256,h=256,f=-1,l=-1,m=0;m<t.length;++m)for(var p=t[m],E=p.rows,v=p.buffer.i32,g=0,T=0;E>T;++T){for(var M=0,y=0;8>y;++y)M+=a(r[s+y]^v[g+y]);u>M?(h=u,u=M,l=m,f=T):h>M&&(h=M),g+=8}if(u<i.match_threshold){for(;n.length<=c;)n.push(new AM.match_t);n[c].screen_idx=d,n[c].pattern_lev=l,n[c].pattern_idx=f,c++}s+=8}return c}return t=r(e,o)},this.GetMatches=function(){return n},this.GetNumMatches=function(){return t},this.SetParameters=function(e){for(name in e)"undefined"!=typeof i[name]&&(i[name]=e[name])}},AM.match_t=function(){function e(e,t,n,i){this.screen_idx=e||0,this.pattern_lev=t||0,this.pattern_idx=n||0,this.distance=i||0}return e}();var AM=AM||{};AM.Pose=function(){function e(e,t,n,i,o,a){for(var r=new jsfeat.motion_model.homography2d,s=4,c=3,d=new jsfeat.ransac_params_t(s,c,.5,.99),u=[],h=[],f=0;t>f;++f){var l=e[f],m=o[l.screen_idx],p=a[l.pattern_lev][l.pattern_idx];u[f]={x:p.x,y:p.y},h[f]={x:m.x,y:m.y}}var E=!1;E=jsfeat.motion_estimator.ransac(d,r,u,h,t,n,i,1e3);var v=0;if(E){for(var f=0;t>f;++f)i.data[f]&&(u[v].x=u[f].x,u[v].y=u[f].y,h[v].x=h[f].x,h[v].y=h[f].y,v++);r.run(u,h,n,v)}else jsfeat.matmath.identity_3x3(n,1);return v}function t(e,t,n){for(var i=[{x:0,y:0},{x:t,y:0},{x:t,y:n},{x:0,y:n}],o=0,a=0,r=0,s=0;4>s;++s)a=e[0]*i[s].x+e[1]*i[s].y+e[2],r=e[3]*i[s].x+e[4]*i[s].y+e[5],o=e[6]*i[s].x+e[7]*i[s].y+e[8],i[s].x=a/o,i[s].y=r/o;return i}var n=0,i=new jsfeat.matrix_t(3,3,jsfeat.F32C1_t),o=new jsfeat.matrix_t(500,1,jsfeat.U8C1_t);this.Pose=function(t,a,r,s){return n=e(t,a,i,o,r,s)},this.GetGoodCount=function(){return n},this.GetPoseCorners=function(e,n){return t(i.data,e,n)}},AM.PosePosit=function(){this.posit=new POS.Posit(10,1),this.pose},AM.PosePosit.prototype.Set=function(e,t,n,i){t=t||35;for(var o=[],a=0;a<e.length;++a){var r=e[a].x-n/2,s=i/2-e[a].y;o.push({x:r,y:s})}this.pose=this.posit.pose(o)},AM.PosePosit.prototype.SetFocalLength=function(e){this.posit.focalLength=e},AM.PoseThree=function(){this.position=new THREE.Vector3,this.rotation=new THREE.Euler,this.quaternion=new THREE.Quaternion,this.scale=new THREE.Vector3},AM.PoseThree.prototype.Set=function(e,t){t=t||35;var n=e.bestRotation,i=e.bestTranslation;this.scale.x=t,this.scale.y=t,this.scale.z=t,this.rotation.x=-Math.asin(-n[1][2]),this.rotation.y=-Math.atan2(n[0][2],n[2][2]),this.rotation.z=Math.atan2(n[1][0],n[1][1]),this.position.x=i[0],this.position.y=i[1],this.position.z=-i[2],this.quaternion.setFromEuler(this.rotation)};var AM=AM||{};AM.TrainedImage=function(e){var t=!0,n=[],i=[],o=0,a=0,r=e,s=!0;this.GetCorners=function(e){return n[e]},this.GetDescriptors=function(e){return n[e]},this.GetLevelNbr=function(){return Math.min(i.length,n.length)},this.GetCornersLevels=function(){return n},this.GetDescriptorsLevels=function(){return i},this.GetWidth=function(){return o},this.GetHeight=function(){return a},this.Set=function(e,r,s,c){t=!1,n=e,i=r,o=s,a=c},this.IsEmpty=function(){return t},this.Empty=function(){t=!0,n=[],i=[]},this.SetUuid=function(e){r=e},this.GetUuid=function(){return r},this.Active=function(e){s=e===!0},this.IsActive=function(e){return s}};var AM=AM||{};AM.Training=function(){function e(e,n,r,s){var d=a[r],u=o[r];0!==r?(t(e,n,s),jsfeat.imgproc.gaussian_blur(n,n,c.blur_size)):jsfeat.imgproc.gaussian_blur(e,n,c.blur_size);var h=AM.DetectKeypointsYape06(n,d,c.training_corners_max,c.laplacian_threshold,c.eigen_threshold);if(d.length=h,jsfeat.orb.describe(n,d,h,u),0!==r)for(i=0;i<h;++i)d[i].x*=1/s,d[i].y*=1/s;console.log("train "+n.cols+"x"+n.rows+" points: "+h)}function t(e,t,n){if(1>n){var i=Math.round(e.cols*n),o=Math.round(e.rows*n);jsfeat.imgproc.resample(e,t,i,o)}else t.resize(e.cols,e.rows),e.copy_to(t)}function n(e,t){for(var n=0;n<c.num_train_levels;++n){a[n]=[];for(var i=a[n],r=e*t>>n;--r>=0;)i[r]=new jsfeat.keypoint_t(0,0,0,0,-1);o[n]=new jsfeat.matrix_t(32,c.training_corners_max,jsfeat.U8_t|jsfeat.C1_t)}}var o,a,r=0,s=0,c={num_train_levels:3,blur_size:3,image_size_max:512,training_corners_max:200,laplacian_threshold:30,eigen_threshold:25},d=Math.sqrt(2);this.Train=function(i){var u=0,h=1;o=[],a=[];var f=new jsfeat.matrix_t(i.width,i.height,jsfeat.U8_t|jsfeat.C1_t);jsfeat.imgproc.grayscale(i.data,i.width,i.height,f,jsfeat.COLOR_RGBA2GRAY);var l=Math.min(c.image_size_max/i.width,c.image_size_max/i.height),m=new jsfeat.matrix_t(i.width*l,i.height*l,jsfeat.U8_t|jsfeat.C1_t);r=m.cols,s=m.rows,t(f,m,l),n(m.cols,m.rows);var p=new jsfeat.matrix_t(m.cols,m.rows,jsfeat.U8_t|jsfeat.C1_t);for(e(m,p,0,h),u=1;u<c.num_train_levels;++u)h/=d,e(m,p,u,h)},this.SetBlurSize=function(e){c.blur_size=e},this.SetMaxImageSize=function(e){c.image_size_max=e},this.SetResultToTrainedImage=function(e){e.Set(a,o,r,s)},this.IsEmpty=function(){return!o||!a},this.Empty=function(){o=void 0,a=void 0},this.SetParameters=function(e){for(name in e)"undefined"!=typeof c[name]&&(c[name]=e[name])}};